$headers = @{
  "x-rapidapi-key" = "<api_key>"
  "x-rapidapi-host" = "v3.football.api-sports.io"
}

# 1. Obtener equipos de Conference League 2023
$teamsResponse = Invoke-WebRequest -Uri "https://v3.football.api-sports.io/teams?league=848&season=2023" -Headers $headers -Method Get
$teamsObj = $teamsResponse.Content | ConvertFrom-Json
$teams = $teamsObj.response

# 2. Crear array de salida
$allPlayers = @()

# 3. Recorrer equipos y a√±adir jugadores
foreach ($team in $teams) {
    $teamId = $team.team.id
    $teamName = $team.team.name
    $playersResponse = Invoke-WebRequest -Uri "https://v3.football.api-sports.io/players?team=$teamId&season=2023" -Headers $headers -Method Get
    $playersObj = $playersResponse.Content | ConvertFrom-Json

    foreach ($playerEntry in $playersObj.response) {
        $playerData = [PSCustomObject]@{
            Name  = $playerEntry.player.name
            Team  = $teamName
            Photo = $playerEntry.player.photo
        }
        $allPlayers += $playerData
    }
}

# 4. Guardar resultado en JSON en el archivo
$path = "<path>/players.txt"
$allPlayers | ConvertTo-Json -Depth 5 | Out-File -FilePath $path -Encoding utf8

Write-Output "Guardado en $path"
